# 🛠️ סקריפטים

תיקייה זו מכילה סקריפטי Dart לניהול ועדכון נתוני המוצרים.

---

## 📋 סקריפטים זמינים

### 1️⃣ `update_products.dart` - עדכון מחירים ומוצרים ⭐

**תפקיד:** הסקריפט המרכזי לעדכון המוצרים מ-Shufersal

**מה הוא עושה:**
- ✅ מוריד מוצרים מ-Shufersal (קבצי XML.gz פומביים)
- ✅ מעדכן **מחירים** למוצרים קיימים (לפי barcode)
- ✅ מוסיף **מוצרים חדשים** אם אין ברשימה
- ✅ יוצר **גיבוי אוטומטי** לפני כל שינוי
- ✅ **מיפוי חכם** - מכניס מוצרים לקובץ הנכון לפי קטגוריה

**הרצה:**
```bash
dart run scripts/update_products.dart
```

**תלויות נדרשות:**
```bash
flutter pub add http archive xml
```

**תצורה:**
ניתן לערוך את הקבועים בתוך הסקריפט:
```dart
const int maxFilesToFetch = 3;  // מספר קבצים להוריד
const double minPrice = 0.5;    // מחיר מינימלי
```

**פלט לדוגמה:**
```
🔄 מעדכן מחירי מוצרים מ-Shufersal
==================================================

📥 מוריד מוצרים מ-Shufersal...
   🌐 גישה ל-https://prices.shufersal.co.il/
   📋 נמצאו 50 קבצים זמינים
   📦 מעבד קובץ 1/3...
      ✅ 245 מוצרים
✅ התקבלו 735 מוצרים

📁 נמצאו 6 קבצי list_types

📄 מעבד: bakery.json
   📦 41 מוצרים קיימים
   🔍 נמצאו 12 מוצרים רלוונטיים
   💰 עודכן: לחם לבן | 10.0 → 10.5 ₪
   ➕ נוסף: בורקס גבינה חדש | 8.5 ₪
   ✅ 3 עודכנו, 2 נוספו
   💾 גיבוי: bakery.json.backup

==================================================
✅ הסתיים בהצלחה!
📊 סיכום:
   💰 15 מחירים עודכנו
   ➕ 8 מוצרים נוספו
```

---

### 2️⃣ `fix_json_categories.dart` - תיקון קטגוריות

**תפקיד:** תיקון אוטומטי של קטגוריות שגויות בקבצי JSON

**מתי להשתמש:**
- כאשר יש מוצרים עם קטגוריות שגויות
- אחרי ייבוא מוצרים חדשים
- לתחזוקה שוטפת

**הרצה:**
```bash
dart run scripts/fix_json_categories.dart
```

**מה הוא עושה:**
1. סורק את כל הקבצים ב-`list_types/`
2. מזהה קטגוריות שגויות לפי:
   - מילות מפתח בשם המוצר
   - שם המותג
3. מתקן את הקטגוריה
4. יוצר גיבוי ושומר

**דוגמאות לתיקונים:**
- "לחם לבן" מ-"מוצרי חלב" → "מאפים"
- "חלב 3%" מ-"ירקות" → "מוצרי חלב"
- "שניצל עוף" מ-"אחר" → "בשר ודגים"

**פלט לדוגמה:**
```
🛠️  סקריפט תיקון קטגוריות JSON
==================================================
📁 נמצאו 6 קבצי JSON

📄 מעבד: bakery.json
   📦 41 מוצרים
   ✅ תוקנו 3 קטגוריות
   💾 גיבוי נשמר: bakery.json.backup
   💾 קובץ עודכן

==================================================
📊 סיכום:
   📦 סה"כ מוצרים נבדקו: 2447
   ✅ סה"כ תוקנו: 12

📝 דוח מפורט של תיקונים:

📄 bakery.json:
   • לחם לבן ביתי
     "מוצרי חלב" → "מאפים"
```

---

## 🗑️ סקריפטים שנמחקו

הסקריפטים הבאים נמחקו במסגרת ניקוי הפרויקט:

### ❌ סקריפטי fetch ישנים:
- `fetch_shufersal_products.dart` - הוחלף ב-`update_products.dart`
- `fetch_multiple_pages.dart` - הוחלף ב-`update_products.dart`
- `split_products_by_category.dart` - לא רלוונטי יותר (שימש עם `categories/`)

### ❌ סקריפטי סנכרון ישנים:
- `sync_bakery_categories.dart` - לא רלוונטי (שימש עם `by_category/`)

### ❌ סקריפטי debug:
- `debug_shufersal_files.dart`
- `check_all_dates.dart`
- `deep_search_files.dart`

---

## 📚 מדריך שימוש

### תרחיש 1: עדכון מחירים שבועי

```bash
# הרץ פעם בשבוע
dart run scripts/update_products.dart
```

זה יעדכן את כל המחירים ויוסיף מוצרים חדשים מ-Shufersal.

---

### תרחיש 2: תיקון קטגוריות אחרי עדכון

```bash
# 1. עדכן מוצרים
dart run scripts/update_products.dart

# 2. תקן קטגוריות
dart run scripts/fix_json_categories.dart
```

---

### תרחיש 3: שחזור מגיבוי

אם משהו השתבש, אפשר לשחזר מהגיבוי:

```bash
cd assets/data/list_types
cp bakery.json.backup bakery.json
```

---

## ⚙️ תצורה מתקדמת

### הוספת קטגוריות חדשות ל-`update_products.dart`

ערוך את המיפוי בסקריפט:

```dart
const Map<String, String> categoryToListType = {
  'לחם ומאפים': 'bakery',
  'מאפים': 'bakery',
  'בשר': 'butcher',
  'בשר ודגים': 'butcher',
  // הוסף כאן קטגוריות נוספות...
};
```

---

### הוספת מילות מפתח ל-`fix_json_categories.dart`

ערוך את הקטגוריות בסקריפט:

```dart
static const Map<String, List<String>> _categoryKeywords = {
  'מאפים': [
    'לחם',
    'חלה',
    'בורקס',
    // הוסף מילות מפתח נוספות...
  ],
};
```

---

## 🚨 טיפים חשובים

### ✅ לפני הרצת סקריפט:
1. וודא שיש **חיבור אינטרנט** (ל-`update_products.dart`)
2. סגור את האפליקציה אם היא פתוחה
3. בדוק שיש **מקום פנוי** בדיסק (לגיבויים)

### ✅ אחרי הרצת סקריפט:
1. בדוק את **הדוח** שהסקריפט מדפיס
2. וודא שהמספרים הגיוניים
3. אפשר למחוק **קבצי .backup** אם הכל תקין

### ⚠️ אזהרות:
- **אל תריץ כמה סקריפטים בו-זמנית** על אותם קבצים
- **אל תמחק את הגיבויים** מיד - חכה יום-יומיים
- **תעשה commit ל-git** לפני הרצת סקריפטים

---

## 🐛 פתרון בעיות

### בעיה: "❌ שגיאה בגישה לאתר"

**פתרון:**
- בדוק חיבור לאינטרנט
- נסה שוב מאוחר יותר (האתר עשוי להיות עמוס)

---

### בעיה: "❌ תיקיית list_types לא נמצאה!"

**פתרון:**
```bash
cd c:/projects/salsheli
# ודא שאתה בתיקיית הפרויקט
pwd
```

---

### בעיה: "Package not found"

**פתרון:**
```bash
flutter pub get
flutter pub add http archive xml
```

---

## 📞 עזרה נוספת

- **תיעוד מבנה נתונים:** `assets/data/README.md`
- **תיעוד קוד:** הערות מפורטות בתוך כל סקריפט

---

**תאריך עדכון אחרון:** 18.11.2024
