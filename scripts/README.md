# 🧹 ניקוי נתונים פגומים - Salsheli

## 🎯 מטרה

ניקוי פריטי מלאי פגומים (עם `productName=null`) מ-Firestore.

---

## 🚀 שיטה 1: דרך האפליקציה (מומלץ)

### צעדים:

1. **הוסף כפתור Debug זמני**
   
   במסך `HomeScreen` או `SettingsScreen`, הוסף כפתור זמני:

   ```dart
   // במסך כלשהו (למשל Settings)
   import 'package:salsheli/screens/debug/cleanup_screen.dart';
   
   // הוסף כפתור:
   ElevatedButton(
     onPressed: () {
       Navigator.push(
         context,
         MaterialPageRoute(
           builder: (context) => CleanupScreen(
             householdId: userContext.user!.householdId,
           ),
         ),
       );
     },
     child: const Text('🧹 ניקוי מלאי פגום'),
   )
   ```

2. **הרץ את האפליקציה**
   ```bash
   flutter run
   ```

3. **לחץ על הכפתור Debug**

4. **במסך הניקוי:**
   - לחץ **"סרוק פריטים פגומים"**
   - המתן לסיום הסריקה
   - לחץ **"מחק X פריטים"**
   - אשר את המחיקה

5. **סיימת! 🎉**

---

## 📋 שיטה 2: סקריפט Dart (מתקדם)

### הערה: לא עובד עדיין

הסקריפט ב-`scripts/clean_corrupted_inventory.dart` דורש Firebase Admin SDK.

כרגע זה לא עובד כי Dart סקריפטים לא יכולים להריץ Firebase בלי Flutter context.

---

## 🛡️ בטיחות

- ✅ הסקריפט מבקש אישור לפני מחיקה
- ✅ מציג את מספר הפריטים שיימחקו
- ✅ אפשר לבטל בכל שלב
- ⚠️ המחיקה בלתי הפיכה!

---

## 📊 מה קורה?

הסקריפט:
1. סורק את כל פריטי המלאי של ה-household
2. מזהה פריטים עם `productName=null`
3. מוחק אותם מ-Firestore

**תוצאה:**
- ✅ מלאי נקי ללא פריטים פגומים
- ✅ ללא המלצות של "מוצר לא ידוע"
- ✅ האפליקציה עובדת מהר יותר

---

## 🔄 אחרי הניקוי

1. צא מהאפליקציה (Kill)
2. הרץ מחדש:
   ```bash
   flutter run
   ```
3. בדוק שהמלאי נקי ✨

---

## 📝 הערות

- הסקריפט בטוח - הוא רק מוחק פריטים עם `productName=null`
- אם אין פריטים פגומים, הוא יודיע על כך
- ניתן להריץ מספר פעמים ללא בעיה

---

## ❓ שאלות

### "איך אני יודע שיש פריטים פגומים?"

ראה את הלוג:
```
⚠️ InventoryItem.fromJson: נתונים פגומים! id=inv_...
```

### "האם זה בטוח?"

כן! הסקריפט:
- ✅ רק מוחק פריטים עם `productName=null`
- ✅ מבקש אישור
- ✅ מציג מה ימחק

### "מה אם אני רוצה לשחזר?"

אין שחזור - המחיקה סופית.
אבל פריטים פגומים ממילא לא שימושיים.

---

**גרסה:** 1.0 | **תאריך:** 15/10/2025
