# 📱 קניה פעילה

## 🎯 מה זה עושה?

מסך "קנייה פעילה" הוא המסך שיוגב רואה כשהוא **בתוך החנות** וקונה.
המסך מציג:
- ⏱️ טיימר - כמה זמן עובר מתחילת הקניה
- 📊 מונים - כמה נקנה, כמה נשאר, כמה לא היה
- רשימת המוצרים לפי קטגוריות
- אפשרות לסמן כל מוצר: נקנה / לא במלאי / לא צריך

---

## 🔄 זרימה - קניה פעילה

```
┌─────────────────────────────────────────────────────────┐
│  יוגב נכנס לרשימה ולוחץ "התחל קנייה"                   │
└──────────────────────┬──────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────┐
│  נפתח מסך קנייה פעילה                                   │
│  • הטיימר מתחיל לרוץ: 00:00                             │
│  • כל המוצרים מוצגים לפי קטגוריה                        │
└──────────────────────┬──────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────┐
│  יוגב עובר בין המוצרים:                                │
│                                                         │
│  🛒 לחץ שמאלה = "נקנה" ✅                               │
│  ❌ לחץ ימינה = "לא במלאי"                              │
│  ⏭️ לחץ למטה = "לא צריך" (דילוג)                       │
└──────────────────────┬──────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────┐
│  כשסיים - לוחץ "סיים קניה"                              │
└──────────────────────┬──────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────┐
│  מסך סיכום קנייה:                                       │
│  • סה"כ זמן: 00:35:22                                   │
│  • נקנו: 12 פריטים                                      │
│  • לא היו: 2 פריטים                                     │
│  • דילגתי: 1 פריט                                       │
│  • סכום כולל: ₪234.50                                   │
└──────────────────────┬──────────────────────────────────┘
                       ↓
              נוצרת "קבלה" בהיסטוריה
```

---

## 📖 דוגמה - יוגב הולך לסופר

**הסיטואציה:** יוגב יוצא לסופר עם רשימה של 15 מוצרים

**מה יוגב עושה:**
1. פותח את הרשימה "קניות לסופ"ש"
2. לוחץ "התחל קנייה"
3. הטיימר מתחיל: 00:00:00

**במהלך הקנייה:**
```
יוגב מגיע לחלב
   → מוצא אותו → מחליק שמאלה → ✅ נקנה

יוגב מגיע לגבינה צהובה מסוימת
   → אין במלאי → מחליק ימינה → ❌ לא במלאי

יוגב רואה "עוגיות" ברשימה
   → החליט לא לקנות → מחליק למטה → ⏭️ לא צריך
```

**בסוף הקנייה:**
1. יוגב לוחץ "סיים קנייה"
2. רואה סיכום עם זמן וכמויות
3. האפליקציה יוצרת "קבלה וירטואלית"
4. המזווה מתעדכן אוטומטית

---

## 📱 איך נראה המסך

```
┌─────────────────────────────────────────────────────────┐
│  ← קניות לסופ"ש                          ⏱️ 00:15:32  │
├─────────────────────────────────────────────────────────┤
│  ✅ נקנו: 8    │    ⏳ נותרו: 5    │    ❌ חסר: 2     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  🥛 מוצרי חלב                                          │
│  ┌────────────────────────────────────────────────────┐│
│  │ ← 📦 חלב 3%                           ₪7.90    → ││
│  │    החלק שמאלה: נקנה | ימינה: לא במלאי           ││
│  └────────────────────────────────────────────────────┘│
│                                                         │
│  ✅ גבינה צהובה                          ₪22.00        │
│  ✅ יוגורט                               ₪5.50         │
│                                                         │
│  🥬 ירקות                                              │
│  ┌────────────────────────────────────────────────────┐│
│  │ ← 📦 עגבניות                          ₪8.00    → ││
│  └────────────────────────────────────────────────────┘│
│                                                         │
├─────────────────────────────────────────────────────────┤
│               [ 🏁 סיים קנייה ]                        │
└─────────────────────────────────────────────────────────┘
```

---

## 🏷️ סטטוסים של מוצרים

| סטטוס | סמל | מה זה אומר | צבע |
|-------|-----|-----------|-----|
| ממתין | ⏳ | עוד לא טיפלתי בו | רגיל |
| נקנה | ✅ | קניתי אותו | ירוק |
| לא במלאי | ❌ | לא היה בחנות | כתום |
| לא צריך | ⏭️ | החלטתי לא לקנות | אפור |

---

## 💾 איפה המידע נשמר?

### קבצים ותפקידים

| קובץ | מה הוא עושה? |
|------|-------------|
| [active_shopping_screen.dart](../../../lib/screens/shopping/active/active_shopping_screen.dart) | מסך הקנייה הפעילה |
| [shopping_lists_provider.dart](../../../lib/providers/shopping_lists_provider.dart) | מעדכן את הרשימה |
| [receipt_provider.dart](../../../lib/providers/receipt_provider.dart) | יוצר קבלה בסוף |
| [inventory_provider.dart](../../../lib/providers/inventory_provider.dart) | מעדכן את המזווה |

### מה מתעדכן ב-Firebase?

**בזמן הקנייה:**
```
shopping_lists/רשימה_id/items/פריט_id:
  is_checked: true  // כשמסמנים "נקנה"
  checked_by: "יוגב_id"
  checked_at: timestamp
```

**בסוף הקנייה (קבלה):**
```
receipts/קבלה_id:
  store_name: "סופרמרקט"
  date: timestamp
  total_amount: 234.50
  is_virtual: true
  shopping_duration: 2132  // שניות
  items: [...]
```

---

## ⚠️ דברים לבדוק

### עובד:
- ✅ טיימר רץ ברקע
- ✅ סימון מוצרים (החלקה)
- ✅ מונים מתעדכנים בזמן אמת
- ✅ יצירת קבלה בסיום
- ✅ עדכון המזווה

### לבדוק:
- ❓ מה קורה אם האפליקציה נסגרת באמצע?
- ❓ האם הנתונים מסתנכרנים בזמן אמת?
- ❓ מה קורה אם אין אינטרנט?

---

## 🔗 קישורים בין מסכים

```
ShoppingListDetailsScreen
          │
    "התחל קנייה"
          ↓
   ActiveShoppingScreen
          │
    "סיים קנייה"
          ↓
  ShoppingSummaryScreen
          │
      "סגור"
          ↓
    HomeDashboard
```

---

## 📝 סיכום

מסך קנייה פעילה הוא הכלי לשימוש **בזמן הקנייה בחנות**.

**תהליך:**
1. התחל קנייה (הטיימר מתחיל)
2. עבור על כל מוצר - סמן נקנה/חסר/לא צריך
3. סיים קנייה
4. צפה בסיכום
5. הכל נשמר אוטומטית

**המידע זורם:**
```
יוגב (בחנות) → ActiveShoppingScreen → ShoppingListsProvider → Firebase
                                              ↓
                                      ReceiptProvider (קבלה)
                                              ↓
                                      InventoryProvider (מזווה)
```
