# 📱 רשימות קניות

## 🎯 מה זה עושה?

זהו הלב של האפליקציה - ניהול רשימות קניות.
מאפשר ליוגב:
- ליצור רשימה חדשה
- לבחור סוג רשימה (סופרמרקט, אטליז, בית מרקחת...)
- להוסיף מוצרים לרשימה
- לסמן מוצרים שנקנו
- לשתף רשימה עם אחרים

---

## 🔄 יצירת רשימה חדשה - זרימה

```
┌─────────────────────────────────────────────────────────┐
│  יוגב לוחץ על "+ רשימה חדשה" בדף הבית                   │
└──────────────────────┬──────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────┐
│  נפתח מסך יצירת רשימה                                   │
└──────────────────────┬──────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────┐
│  יוגב ממלא:                                             │
│  • שם הרשימה: "קניות לסופ"ש"                            │
│  • סוג: 🛒 סופרמרקט                                     │
│  • מי יראה: משפחתית 👨‍👩‍👧                                │
│  • תקציב (אופציונלי): ₪500                              │
└──────────────────────┬──────────────────────────────────┘
                       ↓
┌─────────────────────────────────────────────────────────┐
│  יוגב לוחץ "צור רשימה"                                  │
└──────────────────────┬──────────────────────────────────┘
                       ↓
         ┌─────────────┴─────────────┐
         ↓                           ↓
    [הצלחה]                     [שגיאה]
         ↓                           ↓
    הרשימה נשמרת              "כבר קיימת רשימה
    ב-Firebase                בשם הזה"
         ↓
    עובר למסך הוספת מוצרים
```

---

## 📖 דוגמה מפורטת - יוגב יוצר רשימה

**הסיטואציה:** יוגב רוצה ליצור רשימת קניות לסופ"ש

**מה יוגב עושה:**
1. לוחץ "+ רשימה חדשה" בדף הבית
2. ממלא "קניות לסופ"ש" בשדה השם
3. בוחר סוג רשימה: 🛒 סופרמרקט
4. בוחר "משפחתית" (כל המשפחה תראה)
5. לא מכניס תקציב
6. לוחץ "צור רשימה"

**מה נשמר ב-Firebase:**
```
shopping_lists/רשימה_id:
  name: "קניות לסופ"ש"
  type: "supermarket"
  status: "active"
  household_id: "house_abc123"
  is_private: false
  created_at: "2024-01-15 10:00:00"
  created_by: "יוגב_id"
  items: []
```

---

## 🎨 סוגי רשימות

| סוג | אימוג'י | צבע | מתי משתמשים? |
|-----|---------|-----|--------------|
| סופרמרקט | 🛒 | ירוק | קניות שבועיות |
| בית מרקחת | 💊 | ורוד | תרופות ומוצרי טיפוח |
| ירקן | 🥬 | תכלת | פירות וירקות טריים |
| אטליז | 🥩 | כתום | בשר ודגים |
| מאפיה | 🥖 | צהוב | לחם ומאפים |
| מוצרי בית | 🏠 | תכלת | ניקיון וכדומה |
| אירוע | 🎉 | סגול | מסיבות, אירועים |
| שוק | 🏪 | ירוק | קניות בשוק |

---

## 🔒 מי רואה את הרשימה?

יש 3 אפשרויות:

```
┌──────────────────────────────────────────────────────┐
│                   אישית 🔒                           │
│  רק יוגב רואה. אף אחד אחר לא יכול לראות או לערוך.   │
└──────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────┐
│                  משפחתית 👨‍👩‍👧                         │
│  כל מי שב"בית" (household) של יוגב רואה.            │
│  כולם יכולים לערוך ולהוסיף מוצרים.                  │
└──────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────┐
│                   שיתוף 👥                           │
│  יוגב בוחר אנשים ספציפיים.                          │
│  רק הם רואים (בלי גישה למזווה של יוגב).             │
└──────────────────────────────────────────────────────┘
```

---

## 📖 דוגמה - יוגב משתף רשימה עם חבר

**הסיטואציה:** יוגב רוצה לשתף רשימת אירוע עם חברים

**מה יוגב עושה:**
1. יוצר רשימה חדשה
2. בוחר סוג: 🎉 אירוע
3. בוחר "שיתוף 👥"
4. לוחץ "בחר אנשים לשיתוף"
5. מוסיף:
   - דני (danny@gmail.com) - עורך
   - מיכל (michal@gmail.com) - צופה
6. לוחץ "צור רשימה"

**מה קורה:**
- אם דני רשום - הוא מקבל התראה
- אם דני לא רשום - נשמרת לו הזמנה ממתינה

---

## 🎉 רשימות אירוע - מצבים מיוחדים

כשבוחרים סוג "אירוע", יש 3 אפשרויות:

| מצב | אייקון | מה זה? |
|-----|--------|-------|
| מי מביא מה | 👥 | כל משתתף מתנדב להביא פריטים |
| קנייה רגילה | 🛒 | אדם אחד קונה את כל הרשימה |
| משימות אישיות | ✓ | צ'קליסט פשוט רק לי |

---

## 📋 תבניות מוכנות

יוגב יכול לבחור תבנית מוכנה במקום להתחיל מאפס:

```
┌────────────────────────────────────────────────────┐
│  📋 בחר תבנית:                                     │
│                                                    │
│  🛒 קניות שבועיות רגילות                           │
│  🎂 יום הולדת                                       │
│  🍖 על האש                                          │
│  🏠 ניקיון יסודי                                    │
│  ✡️ חג                                              │
└────────────────────────────────────────────────────┘
```

כשבוחרים תבנית:
1. השם מתמלא אוטומטית
2. סוג הרשימה מתעדכן
3. מוצרים מתווספים אוטומטית

---

## 📱 מסך פרטי רשימה

אחרי יצירת הרשימה, יוגב רואה את מסך פרטי הרשימה:

```
┌─────────────────────────────────────────────────────────┐
│  ←  קניות לסופ"ש                     🔍 ⚙️            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  🥛 מוצרי חלב                                          │
│  ├── □ חלב 3% ליטר                      ₪7.90         │
│  ├── ☑ גבינה צהובה                      ₪22.00   ✓    │
│  └── □ יוגורט                           ₪5.50         │
│                                                         │
│  🥬 ירקות                                              │
│  ├── □ עגבניות ק"ג                      ₪8.00         │
│  └── □ מלפפונים                         ₪4.00         │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  סה"כ: ₪47.40              נותרו: 4 פריטים             │
├─────────────────────────────────────────────────────────┤
│                                    [+ הוסף מוצר]       │
└─────────────────────────────────────────────────────────┘
```

---

## 🔄 הוספת מוצר לרשימה

```
יוגב לוחץ "+ הוסף מוצר"
           ↓
┌─────────────────────────────────────────────────────────┐
│  🔍 חפש מוצר או הקלד חדש                               │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  הצעות:                                                │
│  • 🥛 חלב תנובה 3% ליטר               ₪7.90           │
│  • 🥛 חלב טרה 1% ליטר                 ₪7.50           │
│  • 🥛 חלב סויה אלפרו                  ₪15.90          │
│                                                         │
│  או: צור מוצר חדש "..."                                │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 📖 דוגמה - יוגב מסמן מוצר שנקנה

**הסיטואציה:** יוגב בסופר וקנה חלב

**מה יוגב עושה:**
- לוחץ על הריבוע □ ליד "חלב"

**מה קורה:**
1. הריבוע משתנה ל-☑
2. המוצר עובר לסוף הקטגוריה (או נעלם)
3. הסכום "נותרו X פריטים" מתעדכן
4. ב-Firebase מתעדכן `isChecked: true`

---

## 💾 איפה המידע נשמר?

### קבצים ותפקידים

| קובץ | מה הוא עושה? |
|------|-------------|
| [create_list_screen.dart](../../../lib/screens/shopping/create/create_list_screen.dart) | מסך יצירת רשימה חדשה |
| [shopping_list_details_screen.dart](../../../lib/screens/shopping/details/shopping_list_details_screen.dart) | מסך עריכת הרשימה והמוצרים |
| [shopping_lists_provider.dart](../../../lib/providers/shopping_lists_provider.dart) | "הזיכרון" - שומר את כל הרשימות |
| [shopping_list.dart](../../../lib/models/shopping_list.dart) | "התבנית" - מבנה של רשימה |
| [unified_list_item.dart](../../../lib/models/unified_list_item.dart) | "התבנית" - מבנה של פריט ברשימה |

### מבנה נתונים ב-Firebase

```
households/house_abc123/shopping_lists/רשימה_id:
  name: "קניות לסופ"ש"
  type: "supermarket"
  status: "active"  // active, completed, archived
  is_private: false
  is_shared: false
  created_by: "יוגב_id"
  created_at: timestamp
  updated_at: timestamp
  budget: 500.0
  event_date: null      // לרשימות אירוע - תאריך האירוע
  target_date: null     // לכל רשימה - תאריך יעד (אופציונלי)
  event_mode: null      // who_brings / shopping / tasks
  shared_users: {       // מפה של משתמשים משותפים (לא מערך!)
    "user_id_1": {
      role: "editor",   // owner / admin / editor / viewer
      joined_at: timestamp
    }
  }
  active_shoppers: []   // רשימת קונים פעילים בסשן קניות
  items: [
    {
      id: "פריט_id_1"
      name: "חלב 3%"
      category: "מוצרי חלב"
      quantity: 1
      price: 7.90
      is_checked: false
      added_by: "יוגב_id"
    },
    {
      id: "פריט_id_2"
      name: "גבינה צהובה"
      category: "מוצרי חלב"
      quantity: 1
      price: 22.00
      is_checked: true
      checked_by: "יוגב_id"
    }
  ]
```

---

## ⚠️ דברים לבדוק

### עובד:
- ✅ יצירת רשימה עם שם ייחודי
- ✅ בחירת סוג רשימה
- ✅ הגדרת פרטיות (אישית/משפחתית/שיתוף)
- ✅ בחירת תבנית מוכנה
- ✅ הוספת מוצרים מהקטלוג
- ✅ סימון מוצרים שנקנו
- ✅ חיפוש בתוך הרשימה
- ✅ קיבוץ לפי קטגוריה
- ✅ חישוב סכום כולל

### מה לא מטופל / דורש שיפור:
- ❌ **עריכה בו-זמנית** - אין טיפול בקונפליקטים. משתמש ב-Last-Write-Wins (האחרון דורס). אין real-time listeners לעדכונים חיים
- ❌ **גבול מוצרים** - אין הגבלה על כמות פריטים ברשימה (רק מגבלת Firestore של 1MB לדוקומנט)
- ⚠️ **אין אינטרנט** - חלקי. Firestore תומך בקריאה מcache מובנה, אבל אין offline-first מפורש ואין queue לסנכרון שינויים

---

## 🔗 קישורים בין מסכים

```
                    HomeDashboard
                          │
              "+ רשימה חדשה"
                          ↓
                  CreateListScreen
                          │
                    "צור רשימה"
                          ↓
                PopulateListScreen  ← הוספת מוצרים (לא מתועד כאן)
                          │
                       "סיום"
                          ↓
            ShoppingListDetailsScreen
                          │
             לחיצה על רשימה בדף הבית
                          ↑
                    HomeDashboard
```

---

## 📝 סיכום

רשימות קניות הן הפיצ'ר המרכזי באפליקציה.

**תהליך טיפוסי:**
1. יוגב יוצר רשימה (שם + סוג + פרטיות)
2. מוסיף מוצרים (מהקטלוג או ידנית)
3. הולך לחנות
4. מסמן מוצרים שנקנו
5. כשסיים - סוגר את הרשימה

**המידע זורם:**
```
יוגב → CreateListScreen → ShoppingListsProvider → Firebase
         ↓
     מתעדכן בכל המכשירים של המשפחה
```
