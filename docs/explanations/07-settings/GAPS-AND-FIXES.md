# פערים ותיקונים נדרשים - הגדרות

מסמך זה מפרט את הפערים שנמצאו בין האיפיון לקוד הקיים.

---

## סיכום פערים

| נושא | באיפיון | בקוד | מה צריך לעשות |
|------|---------|------|---------------|
| עריכת פרופיל | מוגדר | חסר | להוסיף מסך עריכה |
| שינוי סיסמה | מוגדר | חסר | להוסיף (רק לאימייל) |
| מחיקת חשבון | מוגדר | חסר | להוסיף עם אזהרות |
| הגדרות התראות | מוגדר | חסר | להוסיף מתגים |
| אין אינטרנט | מוגדר | לא מטופל | להוסיף הודעה |

---

## החלטות שהתקבלו

### 1. עריכת פרופיל

**ההחלטה:** אפשר לערוך שם, תמונה, טלפון - לא אימייל

**מה צריך לממש:**
1. כפתור "ערוך" באזור הפרופיל
2. מסך עריכה עם שדות
3. ולידציה (טלפון תקין, שם לא ריק)
4. שמירה ל-Firebase

**למה לא לערוך אימייל?**
- האימייל הוא מזהה החשבון
- שינוי דורש re-authentication מורכב
- אפשר להוסיף בעתיד אם יש דרישה

---

### 2. שינוי סיסמה

**ההחלטה:** זמין רק למשתמשי אימייל+סיסמה

**מה צריך לממש:**
1. בדיקה: האם המשתמש נרשם עם אימייל?
2. אם כן → כפתור "שנה סיסמה"
3. אם לא (Google/Apple) → הכפתור מוסתר
4. דרישות: 8+ תווים, אות גדולה, מספר

**זרימה:**
1. מכניס סיסמה נוכחית
2. מכניס סיסמה חדשה (פעמיים)
3. ולידציה
4. Firebase `updatePassword()`

---

### 3. מחיקת חשבון

**ההחלטה:** מחיקה מלאה עם אזהרות

**מה נמחק:**
- פרטי משתמש
- רשימות פרטיות
- פריטי מזווה
- העדפות

**מה לא נמחק:**
- רשימות משותפות (רק החברות)
- היסטוריית קניות של הקבוצה

**מה צריך לממש:**
1. כפתור "מחק חשבון" (אדום, למטה)
2. דיאלוג אזהרה עם רשימת מה נמחק
3. שדה להכנסת סיסמה לאימות
4. כפתור "מחק לצמיתות"
5. ניקוי נתונים ב-Firebase
6. התנתקות אוטומטית

**הערה GDPR:**
- המחיקה צריכה להתבצע תוך 30 יום
- בפועל - מיידי (אין צורך להמתין)

---

### 4. הגדרות התראות

**ההחלטה:** מתגים לכל סוג התראה

| התראה | ברירת מחדל | הסבר |
|-------|------------|------|
| הזמנה לקבוצה | ✅ פעיל | חשוב לדעת |
| מלאי נמוך | ✅ פעיל | עוזר לקניות |
| תאריך תפוגה | ❌ כבוי | לא כולם משתמשים |
| עדכון רשימה | ❌ כבוי | יכול להיות הרבה |

**מה צריך לממש:**
1. מסך הגדרות התראות
2. Toggle לכל סוג
3. שמירה ב-SharedPreferences + Firebase
4. בדיקת הרשאת Push מהמכשיר

---

### 5. אין אינטרנט

**ההחלטה:** הודעה + הגדרות מקומיות עובדות

**מה צריך לממש:**
1. הודעה "אין חיבור לאינטרנט"
2. הגדרות מקומיות (ערכת נושא) - עובדות
3. הגדרות שרת (פרופיל, סיסמה) - מושבתות
4. כשהאינטרנט חוזר → הודעה נעלמת

---

## סדר עדיפויות לתיקון

### עדיפות גבוהה (נדרש לפי חוק/אבטחה)
| # | מה לתקן | קובץ |
|---|---------|------|
| 1 | מחיקת חשבון | `settings_screen.dart`, Cloud Function |
| 2 | שינוי סיסמה | `settings_screen.dart` |

### עדיפות בינונית (חוויית משתמש)
| # | מה להוסיף | קובץ |
|---|-----------|------|
| 3 | עריכת פרופיל | `edit_profile_screen.dart` (חדש) |
| 4 | הגדרות התראות | `notification_settings_screen.dart` (חדש) |
| 5 | אין אינטרנט - הודעה | `settings_screen.dart` |

### עדיפות נמוכה (שיפורים)
| # | מה להוסיף | קובץ |
|---|-----------|------|
| 6 | ייצוא נתונים | Cloud Function |

---

## קבצים עיקריים לשינוי

| קובץ | מה לשנות |
|------|----------|
| `lib/screens/settings/settings_screen.dart` | הוספת כפתורים, offline |
| `lib/screens/settings/edit_profile_screen.dart` | ליצור חדש |
| `lib/screens/settings/notification_settings_screen.dart` | ליצור חדש |
| `lib/services/auth_service.dart` | שינוי סיסמה, מחיקה |
| `functions/src/deleteAccount.ts` | Cloud Function למחיקה |

---

## מבנה נתונים להתראות

```
users/משתמש_id/settings:
  notifications:
    group_invite: true
    low_stock: true
    expiry_date: false
    list_update: false
  push_token: "fcm_token_here"
  push_enabled: true
```

---

## סיכום

הפער הכי קריטי: **מחיקת חשבון חסרה!**

לפי GDPR, משתמש חייב יכולת למחוק את החשבון שלו.
זה צריך להיות מתוקן ראשון.

שאר הפערים הם שיפורי חוויית משתמש.

**תאריך עדכון אחרון:** ינואר 2026
