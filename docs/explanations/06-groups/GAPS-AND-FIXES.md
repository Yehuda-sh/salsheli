# פערים ותיקונים נדרשים - קבוצות

מסמך זה מפרט את הפערים שנמצאו בין האיפיון לקוד הקיים.

---

## סיכום פערים

| נושא | באיפיון | בקוד | מה צריך לעשות |
|------|---------|------|---------------|
| אין אינטרנט | מוגדר | לא מטופל | להוסיף הודעה + קריאה בלבד |
| מגבלת חברים | 100 | אין הגבלה | להוסיף בדיקה |
| מגבלת קבוצות | 50 | אין הגבלה | להוסיף בדיקה |
| יציאה מקבוצה | מוגדר | לבדוק | אישור + הודעה למנהלים |
| העברת בעלות | מוגדר | חסום בקוד! | לממש |
| בעלים עוזב | חייב להעביר | לא מטופל | לחסום יציאה בלי העברה |
| עריכת קבוצה | בעלים+מנהלים | לבדוק | לוודא הרשאות |

---

## החלטות שהתקבלו

### 1. אין אינטרנט

**ההחלטה:** כמו שאר המסכים - הודעה + קריאה בלבד

**מה צריך לממש:**
1. הודעה "אין חיבור לאינטרנט"
2. הקבוצות מוצגות (מה שנטען)
3. כפתורי יצירה/עריכה/הזמנה מושבתים
4. כשהאינטרנט חוזר → הודעה נעלמת

---

### 2. מגבלות

| מגבלה | ערך | קובץ לשינוי |
|-------|-----|-------------|
| מקסימום חברים בקבוצה | 100 | `groups_provider.dart` |
| מקסימום קבוצות למשתמש | 50 | `groups_provider.dart` |

**מה צריך לממש:**
- בדיקה לפני הזמנת חבר: "הקבוצה מלאה (100 חברים)"
- בדיקה לפני יצירת קבוצה: "הגעת למקסימום 50 קבוצות"

---

### 3. יציאה מקבוצה

**ההחלטה:** אישור + הודעה למנהלים בלבד

**הזרימה:**
1. חבר לוחץ "עזוב קבוצה"
2. אישור: "בטוח שברצונך לעזוב את [שם הקבוצה]?"
3. אם מאשר → יוצא מהקבוצה
4. הודעה in-app נשלחת למנהלים: "[שם] עזב את הקבוצה"

**מה צריך לממש:**
- כפתור "עזוב קבוצה" במסך פרטי קבוצה
- דיאלוג אישור
- הודעה למנהלים

---

### 4. העברת בעלות

**ההחלטה:** חובה לממש - הבעלים חייב יכולת להעביר

**מצב נוכחי:** הקוד **חוסם** שינוי לתפקיד owner!
- קובץ: `firebase_group_repository.dart` שורה 318
- צריך לשנות את הלוגיקה

**הזרימה הרצויה:**
1. בעלים נכנס להגדרות קבוצה
2. לוחץ "העבר בעלות"
3. בוחר חבר אחר (חייב להיות מנהל?)
4. אישור: "להעביר בעלות ל[שם]?"
5. הבעלות מועברת
6. הבעלים הקודם הופך למנהל

---

### 5. בעלים עוזב קבוצה

**ההחלטה:** לא ניתן לעזוב בלי להעביר בעלות

**מה צריך לממש:**
- אם בעלים לוחץ "עזוב" → הודעה: "כבעלים, עליך להעביר בעלות לפני יציאה"
- כפתור "העבר בעלות" במקום "עזוב"

**אלטרנטיבה לקבוצה עם בעלים בלבד:**
- אם הבעלים היחיד → "מחיקת הקבוצה"
- לא ניתן לעזוב קבוצה שאתה היחיד בה - רק למחוק

---

### 6. עריכת פרטי קבוצה

**ההחלטה:** בעלים ומנהלים יכולים לערוך

| תפקיד | לערוך שם | לערוך תיאור | לערוך הגדרות |
|-------|----------|-------------|--------------|
| בעלים | ✅ כן | ✅ כן | ✅ כן |
| מנהל | ✅ כן | ✅ כן | ❌ לא |
| עורך | ❌ לא | ❌ לא | ❌ לא |
| צופה | ❌ לא | ❌ לא | ❌ לא |

---

## סדר עדיפויות לתיקון

### עדיפות גבוהה (פונקציונליות חסרה קריטית)
| # | מה לתקן | קובץ |
|---|---------|------|
| 1 | העברת בעלות | `firebase_group_repository.dart`, `group_details_screen.dart` |
| 2 | בעלים לא יכול לעזוב בלי העברה | `group_details_screen.dart` |

### עדיפות בינונית
| # | מה להוסיף | קובץ |
|---|-----------|------|
| 3 | אין אינטרנט - הודעה | `groups_list_screen.dart` |
| 4 | מגבלת 100 חברים | `groups_provider.dart` |
| 5 | מגבלת 50 קבוצות | `groups_provider.dart` |
| 6 | יציאה מקבוצה - אישור והודעה | `group_details_screen.dart` |

### עדיפות נמוכה
| # | מה להוסיף | קובץ |
|---|-----------|------|
| 7 | התראות Push | `notification_service.dart` |

---

## קבצים עיקריים לשינוי

| קובץ | מה לשנות |
|------|----------|
| `lib/repositories/firebase_group_repository.dart` | לאפשר העברת בעלות (שורה 318) |
| `lib/screens/groups/group_details_screen.dart` | יציאה, העברת בעלות |
| `lib/screens/groups/groups_list_screen.dart` | offline |
| `lib/providers/groups_provider.dart` | מגבלות |

---

## סיכום

הבאג הכי קריטי: **העברת בעלות חסומה בקוד!**

בלי העברת בעלות:
- בעלים לא יכול לעזוב
- אין דרך להעביר ניהול קבוצה

זה חייב להיות מתוקן ראשון.

**תאריך עדכון אחרון:** ינואר 2026
