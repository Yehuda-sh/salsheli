# פערים ותיקונים נדרשים - הרשמה והתחברות

מסמך זה מפרט את הפערים שנמצאו בין האיפיון לקוד הקיים.

---

## סיכום פערים

| נושא | באיפיון | בקוד | מה צריך לעשות |
|------|---------|------|---------------|
| אין אינטרנט | מוגדר | לא מטופל | להוסיף הודעה לפני ניסיון |
| Timeout | מוגדר | אין | להוסיף timeout 30 שניות |
| Retry | מוגדר | אין | להוסיף ניסיון חוזר |
| תנאי שימוש | TODO בקוד | לא עובד | לקשר לדפים |
| Onboarding | בנוי | לא מחובר | להחליט אם צריך |

---

## החלטות שהתקבלו

### 1. טיפול במצב ללא אינטרנט

**ההחלטה:** לבדוק חיבור לפני ניסיון הרשמה/התחברות

**מה צריך לממש:**
1. בדיקת connectivity לפני שליחת בקשה
2. אם אין אינטרנט → הודעה "אין חיבור לאינטרנט"
3. כפתור "נסה שוב" לאחר חזרת האינטרנט

**הערה חשובה:**
- לא ניתן להתחבר ללא אינטרנט (דורש Firebase)
- אם כבר מחובר - ניתן להמשיך לעבוד offline

---

### 2. Timeout לפעולות

**ההחלטה:** timeout של 30 שניות

**מה צריך לממש:**
1. עטיפת כל פעולת Firebase ב-timeout
2. אחרי 30 שניות → הודעה "הפעולה לוקחת יותר מדי זמן"
3. כפתור "נסה שוב"

**קוד לדוגמה:**
```dart
Future<T> withTimeout<T>(Future<T> operation) {
  return operation.timeout(
    Duration(seconds: 30),
    onTimeout: () => throw TimeoutException('Operation timed out'),
  );
}
```

---

### 3. ניסיון חוזר (Retry)

**ההחלטה:** ניסיון אחד אוטומטי + כפתור ידני

**מה צריך לממש:**
1. אם נכשל בגלל רשת → ניסיון חוזר אוטומטי (פעם אחת)
2. אם עדיין נכשל → הודעה + כפתור "נסה שוב"
3. לא לנסות שוב לשגיאות לוגיות (סיסמה שגויה וכו')

---

### 4. תנאי שימוש ופרטיות

**מצב נוכחי:** כפתורים קיימים אבל לא עובדים

**מה צריך לממש:**
1. ליצור דפי תנאי שימוש ופרטיות
2. לקשר מהכפתורים ב-Welcome Screen
3. אפשרות א': דפי HTML סטטיים
4. אפשרות ב': Markdown בתוך האפליקציה

**קובץ לתיקון:** `welcome_screen.dart` שורות 190-216

---

### 5. מסך Onboarding

**מצב נוכחי:** בנוי אבל לא מחובר לזרימה

**ההחלטה:** להחליט אם צריך

**אפשרויות:**
1. **להפעיל** - לחבר לזרימה אחרי הרשמה
2. **להסיר** - למחוק את הקוד אם לא צריך
3. **לדחות** - להשאיר לפיתוח עתידי

**המלצה:** לדחות לגרסה הבאה

---

## סדר עדיפויות לתיקון

### עדיפות גבוהה (חוויית משתמש קריטית)
| # | מה לתקן | קובץ |
|---|---------|------|
| 1 | בדיקת אינטרנט לפני הרשמה/התחברות | `auth_service.dart` |
| 2 | Timeout 30 שניות | `auth_service.dart` |

### עדיפות בינונית
| # | מה להוסיף | קובץ |
|---|-----------|------|
| 3 | תנאי שימוש - קישורים | `welcome_screen.dart` |
| 4 | ניסיון חוזר אוטומטי | `auth_service.dart` |

### עדיפות נמוכה (שיפורים עתידיים)
| # | מה להוסיף | קובץ |
|---|-----------|------|
| 5 | Onboarding - החלטה | `onboarding_screen.dart` |
| 6 | API deprecated - עדכון | `onboarding_screen.dart` שורות 126, 163 |

---

## קוד בעייתי שנמצא

### 1. TODOs ריקים - Welcome Screen
```dart
// welcome_screen.dart שורות 190-216
// כפתורי "תנאי שימוש" ו"מדיניות פרטיות" לא עושים כלום
```

### 2. API ישנה - Onboarding
```dart
// onboarding_screen.dart שורות 126, 163
// משתמש ב-savePreferences() ה-deprecated
// צריך לעדכן ל-savePreferencesResult()
```

### 3. מסך לא מחובר
```dart
// onboarding_screen.dart בנוי אך אין לו route ב-main.dart
```

---

## קבצים עיקריים לשינוי

| קובץ | מה לשנות |
|------|----------|
| `lib/services/auth_service.dart` | timeout, retry, connectivity |
| `lib/screens/welcome/welcome_screen.dart` | קישורים לתנאי שימוש |
| `lib/screens/onboarding/onboarding_screen.dart` | עדכון API / החלטה על עתיד |

---

## סיכום

הפער הכי משמעותי: **אין טיפול ב-timeout ו-connectivity**

אם אין אינטרנט, המשתמש יחכה דקות ארוכות בלי הודעה.
זה צריך להיות מתוקן ראשון.

**תאריך עדכון אחרון:** ינואר 2026
