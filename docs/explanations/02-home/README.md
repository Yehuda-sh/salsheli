# 📱 דף הבית הראשי

## 🎯 מה זה עושה?

דף הבית הוא המסך הראשון שרואים אחרי ההתחברות.
הוא מציג:
- ברכה אישית עם השם של המשתמש
- הודעה אם יש הזמנות לקבוצות ממתינות
- כל הרשימות הפעילות שלך
- היסטוריית קניות (קבלות)
- כפתור ליצירת רשימה חדשה

---

## 🏗️ מבנה המסך הראשי

האפליקציה בנויה עם **4 טאבים** בתחתית:

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│                    [תוכן המסך]                          │
│                                                         │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  🏠 בית  │  📦 מזווה  │  👥 קבוצות  │  ⚙️ הגדרות     │
└─────────────────────────────────────────────────────────┘
```

| טאב | שם | מה מציג |
|-----|----|---------|
| 0 | בית | רשימות פעילות + היסטוריה |
| 1 | מזווה | המלאי שיש בבית |
| 2 | קבוצות | קבוצות משפחה/שיתוף |
| 3 | הגדרות | הגדרות אישיות |

---

## 🔄 מה יוגב רואה כשהוא נכנס לדף הבית?

```
┌─────────────────────────────────────────────────────────┐
│  ┌──────────────────────────────────────────────────┐  │
│  │ 👋  שלום, יוגב!                          📬 (2)  │  │
│  └──────────────────────────────────────────────────┘  │
│                                                         │
│  🛒 רשימות פעילות                                  (3) │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 🛒 קניות שבועיות          נותרו 5 פריטים        │  │
│  │ ████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  40%  │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 💊 בית מרקחת              נותרו 2 פריטים        │  │
│  │ ██████████████████████████░░░░░░░░░░░░░░░  80%  │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │ 🥬 ירקות                  הושלם! ✓              │  │
│  │ ██████████████████████████████████████████ 100%  │  │
│  └──────────────────────────────────────────────────┘  │
│                                                         │
│  📜 היסטוריה                                ▼ (פתח)   │
│                                                         │
│                                    ┌──────────────┐     │
│                                    │ + רשימה חדשה │     │
│                                    └──────────────┘     │
└─────────────────────────────────────────────────────────┘
```

---

## 📖 דוגמה מפורטת - מה קורה כשיוגב פותח את האפליקציה?

**הסיטואציה:** יוגב כבר רשום ומחובר. הוא פותח את האפליקציה.

**מה קורה צעד אחר צעד:**

1. **האפליקציה טוענת את המידע:**
   - מביאה את הרשימות של יוגב מ-Firebase
   - מביאה את ההיסטוריה (קבלות)
   - בודקת אם יש הזמנות לקבוצות ממתינות

2. **יוגב רואה:**
   - "שלום, יוגב!" + אייקון 👋
   - אם יש לו הזמנות ממתינות - רואה אייקון מעטפה עם מספר (📬)
   - רשימות פעילות עם פס התקדמות

3. **יוגב לוחץ על רשימה:**
   - נפתח מסך פרטי הרשימה עם כל המוצרים

4. **יוגב לוחץ על כפתור "+ רשימה חדשה":**
   - נפתח מסך יצירת רשימה חדשה

---

## 🔄 זרימת מידע - איך המידע מגיע לדף הבית?

```
┌─────────────────┐     ┌─────────────────────┐     ┌─────────────────┐
│    Firebase     │ --> │ ShoppingListsProvider│ --> │ HomeDashboard  │
│   (בענן)        │     │   (זוכר רשימות)      │     │   (מציג)       │
└─────────────────┘     └─────────────────────┘     └─────────────────┘

┌─────────────────┐     ┌─────────────────────┐     ┌─────────────────┐
│    Firebase     │ --> │   ReceiptProvider   │ --> │ HomeDashboard  │
│   (בענן)        │     │   (זוכר קבלות)      │     │   (מציג)       │
└─────────────────┘     └─────────────────────┘     └─────────────────┘

┌─────────────────┐     ┌─────────────────────┐     ┌─────────────────┐
│    Firebase     │ --> │PendingInvitesProvider│--> │ HomeDashboard  │
│   (בענן)        │     │  (הזמנות ממתינות)   │     │ (מציג 📬)      │
└─────────────────┘     └─────────────────────┘     └─────────────────┘
```

---

## 📖 דוגמה - יוגב מרענן את הדף

**מה יוגב עושה:**
- מושך למטה (Pull to Refresh)

**מה קורה:**
1. האפליקציה מראה אנימציית טעינה
2. מבקשת מ-Firebase את הנתונים העדכניים
3. מעדכנת את:
   - רשימות הקניות
   - ההיסטוריה (קבלות)
   - הצעות חכמות
4. הכל מתעדכן על המסך

---

## 💾 איפה המידע נשמר?

### קבצים ותפקידים

| קובץ | מה הוא עושה? |
|------|-------------|
| [main_navigation_screen.dart](../../../lib/screens/main_navigation_screen.dart) | המסגרת הראשית - 4 הטאבים בתחתית |
| [home_dashboard_screen.dart](../../../lib/screens/home/dashboard/home_dashboard_screen.dart) | דף הבית עצמו - מה רואים בתוך |
| [shopping_lists_provider.dart](../../../lib/providers/shopping_lists_provider.dart) | "הזיכרון" - שומר את כל הרשימות |
| [receipt_provider.dart](../../../lib/providers/receipt_provider.dart) | שומר את היסטוריית הקניות |
| [pending_invites_provider.dart](../../../lib/providers/pending_invites_provider.dart) | שומר הזמנות ממתינות |
| [user_context.dart](../../../lib/providers/user_context.dart) | מי המשתמש המחובר (שם, אימייל) |

### איך הם עובדים יחד?

```
MainNavigationScreen
├── Tab 0: HomeDashboardScreen  ← דף הבית
│   ├── Header (ברכה + התראות)
│   ├── Active Lists (רשימות פעילות)
│   └── History (היסטוריה)
│
├── Tab 1: MyPantryScreen       ← מזווה
├── Tab 2: GroupsListScreen     ← קבוצות
└── Tab 3: SettingsScreen       ← הגדרות
```

---

## 🎯 פעולות שאפשר לעשות בדף הבית

| פעולה | מה קורה | לאן עוברים |
|-------|---------|-----------|
| לחיצה על רשימה | פותח את הרשימה | מסך פרטי רשימה |
| לחיצה על "+ רשימה חדשה" | יוצר רשימה חדשה | מסך יצירת רשימה |
| לחיצה על 📬 (הזמנות) | מציג הזמנות ממתינות | מסך הזמנות לקבוצות |
| משיכה למטה | מרענן את המידע | נשאר באותו מסך |
| לחיצה על קבלה בהיסטוריה | מציג פרטי קבלה | מסך פרטי קבלה |

---

## ⚠️ התנהגויות מיוחדות

### כפתור "חזרה" (Back)

```
מה קורה כשיוגב לוחץ "חזרה":

בטאב 1-3 (מזווה/קבוצות/הגדרות):
    ↓
חוזר לטאב 0 (דף הבית)

בטאב 0 (דף הבית) - לחיצה ראשונה:
    ↓
"לחץ פעם נוספת ליציאה"

בטאב 0 - לחיצה שנייה תוך 2 שניות:
    ↓
יוצא מהאפליקציה
```

### אם אין רשימות פעילות

```
┌──────────────────────────────────────────────────┐
│                                                  │
│              🛒                                  │
│                                                  │
│        אין רשימות פעילות                         │
│    לחץ כאן ליצירת רשימה חדשה                     │
│                                                  │
└──────────────────────────────────────────────────┘
```

---

## 🎨 עיצוב מיוחד

### צבעי רשימות לפי סוג

| סוג רשימה | צבע | אימוג'י |
|----------|-----|---------|
| סופרמרקט | ירוק 🟢 | 🛒 |
| בית מרקחת | ורוד 🩷 | 💊 |
| ירקן | תכלת 🔵 | 🥬 |
| קצביה | כתום 🟠 | 🥩 |
| מאפיה | צהוב 🟡 | 🥖 |
| אירוע | סגול 🟣 | 🎉 |

### פס התקדמות

```
רשימה עם 3 מתוך 10 מסומנים:
████████████░░░░░░░░░░░░░░░░░░░░░░  30% (בצבע הרשימה)

רשימה מושלמת (100%):
████████████████████████████████████  ✓ (ירוק)
```

---

## 📶 טיפול במצב ללא אינטרנט

**מה צריך לקרות:**
1. אין אינטרנט? → מופיעה הודעה "אין חיבור לאינטרנט"
2. האפליקציה עדיין מציגה את הנתונים האחרונים (לקריאה בלבד)
3. כשהאינטרנט חוזר → הודעה נעלמת והכל מסתנכרן אוטומטית

**למה?**
- עבודה בלי אינטרנט מסוכנת - נתונים יכולים ללכת לאיבוד
- המשתמש צריך לדעת שמשהו לא עובד

---

## 📊 מיון רשימות

**ברירת מחדל:** חדש למעלה (לפי תאריך עדכון)

**אפשרויות מיון נוספות (לבחירת המשתמש):**
1. 📅 חדש למעלה (ברירת מחדל)
2. 📅 ישן למעלה
3. 🔤 לפי שם (א-ת)
4. 📊 לפי אחוז השלמה
5. ⏰ לפי תאריך יעד (הקרוב למעלה)

---

## 📜 כפתור היסטוריה קבוע

**הבעיה:** אם יש הרבה רשימות, המשתמש צריך לגלול הרבה כדי להגיע להיסטוריה.

**הפתרון:** כפתור קבוע בראש המסך לגישה מהירה להיסטוריה.

```
┌─────────────────────────────────────────────────────────┐
│  👋 שלום, יוגב!                    [📜 היסטוריה]  🔔   │
│                                                         │
│  🛒 רשימות פעילות (15)                                 │
│  ...                                                    │
└─────────────────────────────────────────────────────────┘
```

---

## ✏️ מצב עריכה

**איך זה עובד:**
1. בדף הבית → כפתור "ערוך" (עיפרון) בפינה
2. לוחצים → נכנסים ל"מצב עריכה"
3. ליד כל רשימה מופיע:
   - 🗑️ מחיקה (רק אם אתה **בעלים** של הרשימה)
   - ✏️ עריכת שם (אם אתה בעלים או מנהל)
4. לוחצים שוב על "סיום" → יוצאים ממצב עריכה

**הרשאות:**
| תפקיד | יכול למחוק? | יכול לערוך שם? |
|--------|-------------|----------------|
| בעלים | ✅ כן | ✅ כן |
| מנהל | ❌ לא | ✅ כן |
| עורך | ❌ לא | ❌ לא |
| צופה | ❌ לא | ❌ לא |

---

## ⚠️ טיפול בשגיאות

**מה צריך לקרות:**
- שגיאה בטעינה? → הודעה "לא הצלחנו לטעון את הנתונים"
- כפתור "נסה שוב" → מנסה לטעון מחדש
- הנתונים הישנים עדיין נראים (אם יש)

---

## 🔄 עדכון בזמן אמת

**חובה לרשימות משותפות!**

**דוגמה:**
- יוגב עומד בכניסה לסופר
- שרה (אשתו) מוסיפה "חלב" לרשימה
- מיד מופיע ליוגב "חלב" ברשימה (בלי Pull to Refresh)

**איך זה עובד:**
- האפליקציה "מאזינה" לשינויים בשרת
- כל שינוי שמישהו עושה → מופיע מיד לכולם

---

## ⏰ טיפול בתאריך יעד שעבר

**מה קורה כשתאריך היעד של רשימה עבר:**
1. סימון אדום "עבר התאריך" ליד הרשימה
2. אפשרויות למשתמש:
   - "ארכב" - להעביר לארכיון
   - "עדכן תאריך" - לקבוע תאריך חדש
3. אם לא עושה כלום 7 ימים → עוברת לארכיון אוטומטית (לא נמחקת!)

---

## ✅ רשימה שהגיעה ל-100%

**מה קורה כשרשימה מסומנת לגמרי:**
- כפתור מהיר "סיים קנייה" מופיע ליד הרשימה בדף הבית
- חוסך כניסה לרשימה רק כדי ללחוץ על הכפתור הירוק

```
┌──────────────────────────────────────────────────────┐
│ 🥬 ירקות                  הושלם! ✓    [סיים קנייה] │
│ ██████████████████████████████████████████████ 100%  │
└──────────────────────────────────────────────────────┘
```

---

## 🛒 קנייה פעילה

**מה קורה אם יש קנייה פעילה:**
- כשנכנסים לאפליקציה → banner "יש לך קנייה פעילה - להמשיך?"
- לחיצה על Banner → חוזרים למסך הקנייה

**אחרי 6 שעות ללא פעילות:**
- הסשן מתנקה אוטומטית
- הסימונים על הפריטים נשארים!
- כשחוזרים → "להמשיך מאיפה שנעצר או להתחיל מחדש?"

---

## ⚠️ דברים לבדוק

### עובד:
- ✅ טעינת רשימות מ-Firebase
- ✅ הצגת הזמנות ממתינות
- ✅ Pull to Refresh
- ✅ ניווט לרשימה בלחיצה
- ✅ כפתור יצירת רשימה
- ✅ היסטוריה עם pagination (טען עוד)
- ✅ Double-tap ליציאה
- ✅ Tutorial - מופיע רק בפעם הראשונה

### צריך להוסיף:
- ⚠️ **אין אינטרנט** - הודעה למשתמש + לחכות לחיבור
- ⚠️ **מיון רשימות** - ברירת מחדל חדש למעלה + אפשרויות
- ⚠️ **כפתור היסטוריה קבוע** - גישה מהירה
- ⚠️ **מצב עריכה** - מחיקה/עריכה לפי הרשאות
- ⚠️ **עדכון בזמן אמת** - לרשימות משותפות
- ⚠️ **הצגת שגיאות** - הודעה + כפתור "נסה שוב"
- ⚠️ **תאריך יעד שעבר** - סימון + ארכיון אוטומטי
- ⚠️ **Banner קנייה פעילה** - להמשיך?

### ראה גם:
- [GAPS-AND-FIXES.md](./GAPS-AND-FIXES.md) - פערים ותיקונים נדרשים

---

## 🔗 ניווט מדף הבית

| פעולה | מסך יעד | קובץ |
|-------|---------|------|
| לחיצה על רשימה | פרטי רשימה | `shopping_list_details_screen.dart` |
| "+ רשימה חדשה" | יצירת רשימה | `create_list_screen.dart` |
| לחיצה על 📬 | הזמנות ממתינות | `pending_group_invites_screen.dart` |
| לחיצה על קבלה | פרטי קבלה | `receipt_details_screen.dart` |

---

## 📝 סיכום

דף הבית הוא המרכז של האפליקציה.
ממנו אפשר:
- לראות את כל הרשימות הפעילות
- לעבור לפרטי רשימה
- ליצור רשימה חדשה
- לראות היסטוריה
- לעבור לטאבים אחרים (מזווה, קבוצות, הגדרות)
