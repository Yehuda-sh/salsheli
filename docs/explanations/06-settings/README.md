# 📱 הגדרות והיסטוריה

## 🎯 מה זה עושה?

מסך ההגדרות מאפשר ליוגב:
- לראות את הפרופיל שלו
- לראות סטטיסטיקות (כמה רשימות, קבלות, פריטים)
- לשנות הגדרות אישיות
- להתנתק מהאפליקציה

---

## 📱 איך נראה מסך ההגדרות

```
┌─────────────────────────────────────────────────────────┐
│  ⚙️ הגדרות                                             │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌────────────────────────────────────────────────────┐ │
│  │         👤                                         │ │
│  │     יוגב כהן                                       │ │
│  │   yogev@gmail.com                                  │ │
│  └────────────────────────────────────────────────────┘ │
│                                                         │
│  📊 סטטיסטיקות                                         │
│  ┌────────────┬────────────┬────────────┐             │
│  │ 📋 5       │ 🧾 12      │ 📦 28      │             │
│  │ רשימות     │ קבלות      │ פריטים     │             │
│  └────────────┴────────────┴────────────┘             │
│                                                         │
│  ⚙️ העדפות                                             │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 🌙 מצב כהה                              [ ✓ ]     │ │
│  │ 📱 תצוגה מרוכזת                         [   ]     │ │
│  │ 💰 הצג מחירים                           [ ✓ ]     │ │
│  └────────────────────────────────────────────────────┘ │
│                                                         │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 🔄 עדכן מחירים                                    │ │
│  │ 📖 הצג הדרכה                                      │ │
│  │ 🚪 התנתק                                          │ │
│  └────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## ⚙️ הגדרות זמינות

| הגדרה | מה זה עושה |
|-------|-----------|
| **מצב כהה** | משנה את העיצוב לכהה (לילה) |
| **תצוגה מרוכזת** | מציג פחות פרטים על כל פריט |
| **הצג מחירים** | מראה/מסתיר מחירים ברשימות |

---

## 📊 סטטיסטיקות

המסך מציג מספרים מעניינים:

| מדד | מה זה מראה |
|-----|-----------|
| 📋 רשימות | כמה רשימות פעילות יש |
| 🧾 קבלות | כמה קניות סיימת |
| 📦 פריטים | כמה מוצרים יש במזווה |

---

## 📖 דוגמה - יוגב רוצה מצב כהה

**מה יוגב עושה:**
1. פותח טאב "הגדרות" ⚙️
2. מוצא "מצב כהה"
3. לוחץ על המתג (Toggle)

**מה קורה:**
1. כל האפליקציה משתנה לצבעים כהים
2. ההגדרה נשמרת בטלפון
3. בפעם הבאה שיפתח - יהיה כהה

---

## 🚪 התנתקות

כשיוגב לוחץ "התנתק":

```
┌─────────────────────────────────────────────────────────┐
│              ⚠️ האם להתנתק?                            │
│                                                         │
│  כל הנתונים המקומיים יימחקו:                           │
│  • העדפות                                               │
│  • Cache                                                │
│                                                         │
│  (הנתונים בענן נשמרים)                                 │
│                                                         │
│        [ביטול]              [התנתק]                    │
└─────────────────────────────────────────────────────────┘
```

---

## 📜 היסטוריה (קבלות)

ההיסטוריה מופיעה בדף הבית, אבל אפשר לראות פרטים מלאים:

```
┌─────────────────────────────────────────────────────────┐
│  🧾 פרטי קבלה                                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  🏪 סופר יוחננוף                                       │
│  📅 15/01/2024                                          │
│  ⏱️ 35 דקות                                            │
│                                                         │
│  📋 פריטים:                                             │
│  • חלב 3% ליטר              ₪7.90                      │
│  • גבינה צהובה              ₪22.00                     │
│  • יוגורט x3                ₪16.50                     │
│  ...                                                    │
│                                                         │
│  ────────────────────────────────────                  │
│  סה"כ:                      ₪234.50                    │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 💾 איפה המידע נשמר?

### קבצים ותפקידים

| קובץ | מה הוא עושה? |
|------|-------------|
| [settings_screen.dart](../../../lib/screens/settings/settings_screen.dart) | מסך ההגדרות |
| [receipt_details_screen.dart](../../../lib/screens/history/receipt_details_screen.dart) | פרטי קבלה |
| [user_context.dart](../../../lib/providers/user_context.dart) | שומר העדפות |
| [receipt_provider.dart](../../../lib/providers/receipt_provider.dart) | שומר קבלות |

### מה נשמר ואיפה?

**בטלפון (SharedPreferences):**
```
themeMode: 1  // 0=light, 1=dark, 2=system
compactView: false
showPrices: true
householdName: "משפחת כהן"
householdType: "family"
```

**ב-Firebase (קבלות):**
```
receipts/קבלה_id:
  store_name: "סופר יוחננוף"
  date: timestamp
  total_amount: 234.50
  shopping_duration: 2100  // שניות
  is_virtual: true
  household_id: "house_abc123"
  items: [...]
```

---

## ✏️ עריכת פרופיל

**מה אפשר לערוך:**
- ✅ שם תצוגה
- ✅ תמונת פרופיל
- ✅ מספר טלפון

**מה לא אפשר לערוך:**
- ❌ אימייל (מזהה החשבון)

**הזרימה:**
1. לוחץ על אזור הפרופיל
2. נפתח מסך עריכה
3. משנה את הפרטים
4. לוחץ "שמור"

---

## 🔐 שינוי סיסמה

**זמין רק למשתמשים שנרשמו עם אימייל+סיסמה** (לא Google/Apple)

**הזרימה:**
1. לוחץ "שנה סיסמה"
2. מכניס סיסמה נוכחית
3. מכניס סיסמה חדשה (פעמיים)
4. לוחץ "שמור"

**דרישות סיסמה:**
- מינימום 8 תווים
- לפחות אות גדולה ומספר

---

## 🗑️ מחיקת חשבון

**מה קורה כשמוחקים:**
1. כל הנתונים האישיים נמחקים
2. יציאה מכל הקבוצות
3. רשימות פרטיות נמחקות
4. רשימות משותפות - נשארות (רק החברות נמחקת)

**הזרימה:**
1. לוחץ "מחק חשבון"
2. אזהרה: "פעולה זו בלתי הפיכה!"
3. מכניס סיסמה לאימות
4. לוחץ "מחק לצמיתות"
5. מועבר למסך התחברות

**חשוב:** המחיקה מתבצעת תוך 30 יום (לפי GDPR)

---

## 🔔 הגדרות התראות

| התראה | ברירת מחדל | מה מקבלים |
|-------|------------|-----------|
| הזמנה לקבוצה | ✅ פעיל | "הוזמנת לקבוצה X" |
| מלאי נמוך | ✅ פעיל | "החלב עומד להיגמר" |
| תאריך תפוגה | ❌ כבוי | "לחלב נשארו 3 ימים" |
| עדכון רשימה | ❌ כבוי | "שרה הוסיפה פריט לרשימה" |

**הערה:** התראות Push דורשות הרשאה מהמכשיר

---

## 📶 טיפול במצב ללא אינטרנט

**מה קורה:**
1. אין אינטרנט? → הודעה "אין חיבור לאינטרנט"
2. ההגדרות מוצגות (לקריאה בלבד)
3. לא ניתן לשנות הגדרות עד שיש חיבור
4. כשהאינטרנט חוזר → הודעה נעלמת, ניתן לערוך

**יוצא מן הכלל:**
- הגדרות מקומיות (ערכת נושא, תצוגה) - ניתנות לשינוי גם offline

---

## ⚠️ דברים לבדוק

### עובד:
- ✅ שינוי ערכת נושא (בהיר/כהה)
- ✅ שמירת העדפות מקומית
- ✅ התנתקות בטוחה
- ✅ הצגת סטטיסטיקות
- ✅ צפייה בקבלות

### צריך להוסיף/לתקן:
- ⚠️ **עריכת פרופיל** - מסך עריכה מלא
- ⚠️ **שינוי סיסמה** - רק למשתמשי אימייל
- ⚠️ **מחיקת חשבון** - עם אזהרות מתאימות
- ⚠️ **הגדרות התראות** - מתגים לכל סוג
- ⚠️ **אין אינטרנט** - הודעה + הגבלת פעולות

### ראה גם:
- [GAPS-AND-FIXES.md](./GAPS-AND-FIXES.md) - פערים ותיקונים נדרשים

---

## 🔗 קישורים בין מסכים

```
MainNavigationScreen
       │
  Tab 3: הגדרות
       ↓
 SettingsScreen
       │
       ├── "התנתק" → LoginScreen
       │
       ├── "הצג הדרכה" → Tutorial
       │
       └── "עדכן מחירים" → רענון נתונים
```

---

## 📝 סיכום

מסך ההגדרות הוא **מרכז הבקרה** של יוגב.

**מה אפשר לעשות:**
- לראות מידע על החשבון
- לשנות העדפות עיצוב
- לראות סטטיסטיקות
- להתנתק

**ההיסטוריה:**
- מציגה את כל הקניות שעשה
- כולל פירוט מוצרים ומחירים
- כולל זמן קנייה
