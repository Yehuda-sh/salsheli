# 📁 מבנה תיקיית `assets/data/`

תיקייה זו מכילה את כל נתוני המוצרים לאפליקציית רשימת הקניות.

---

## 📂 מבנה התיקיות

```
assets/
├── data/
│   └── list_types/          ✅ קבצי מוצרים לפי סוג רשימה
│       ├── supermarket.json
│       ├── bakery.json
│       ├── butcher.json
│       ├── greengrocer.json
│       ├── pharmacy.json
│       └── market.json
│
├── templates/               ✅ תבניות רשימות מוכנות
│   ├── list_templates.json
│   ├── event_bbq.json
│   ├── shopping_weekly.json
│   └── pantry_basic.json
│
├── images/                  ✅ תמונות
└── fonts/                   ✅ פונטים
```

---

## 📄 תיאור הקבצים

### `list_types/` - קבצי מוצרים לפי סוג רשימה

כל קובץ JSON מכיל מוצרים **רלוונטיים לסוג הרשימה** (לא מסודר לפי קטגוריה).

#### פורמט המוצר:
```json
{
  "name": "שם המוצר",
  "category": "קטגוריה (מאפים, ירקות, וכו')",
  "icon": "🍞",
  "price": 10.0,
  "barcode": "7290001234567",
  "brand": "שם המותג",
  "unit": "יחידה / 100 גרם / ליטר",
  "store": "שופרסל / אחר",
  "image_url": "קישור לתמונה (אופציונלי)"
}
```

#### קבצים:

| קובץ | תיאור | דוגמאות מוצרים |
|------|-------|----------------|
| **supermarket.json** | כל המוצרים (הכי מקיף) | חלב, לחם, ירקות, בשר, ניקיון... |
| **bakery.json** | מוצרים למאפייה | לחם, חלה, בורקס, עוגיות, קרואסון |
| **butcher.json** | מוצרים לקצב | בשר בקר, עוף, כבש, נקניקים |
| **greengrocer.json** | מוצרים לירקן | עגבניות, מלפפון, בצל, תפוחים, בננות |
| **pharmacy.json** | מוצרים לבית מרקחת | תרופות, ויטמינים, חיתולים, מסכות |
| **market.json** | מוצרים לשוק | כל סוגי המוצרים לשוק |

---

## 🔄 עדכון מחירים ומוצרים

### סקריפט: `scripts/update_products.dart`

הסקריפט מעדכן מחירים ומוסיף מוצרים חדשים מ-Shufersal.

#### 🚀 הרצה:
```bash
dart run scripts/update_products.dart
```

#### מה הסקריפט עושה?
1. ✅ **מוריד מוצרים** מ-Shufersal (קבצי XML.gz פומביים)
2. ✅ **מעדכן מחירים** למוצרים קיימים (לפי barcode)
3. ✅ **מוסיף מוצרים חדשים** אם אין ברשימה
4. ✅ **יוצר גיבוי** לפני כל שינוי
5. ✅ **מיפוי חכם** - מוסיף מוצרים לקובץ הנכון לפי קטגוריה

#### תצורה (בתוך הסקריפט):
```dart
const int maxFilesToFetch = 3;  // כמה קבצים להוריד מ-Shufersal
const double minPrice = 0.5;    // מחיר מינימלי (להתעלמות ממוצרי שגיאה)
```

---

## 🛠️ סקריפטים נוספים

### `scripts/fix_json_categories.dart`
תיקון אוטומטי של קטגוריות שגויות בקבצי JSON.

```bash
dart run scripts/fix_json_categories.dart
```

**דוגמה:**
- "לחם לבן" שמסווג כ-"מוצרי חלב" → מתוקן ל-"מאפים"

---

## ⚠️ חשוב לדעת

### 1. **`list_types/` הוא המקור היחיד**
האפליקציה קוראת **רק** מ-`list_types/`.
כל שינוי חייב להתבצע בקבצים האלה.

### 2. **קטגוריות מעורבות**
כל קובץ יכול להכיל **מספר קטגוריות**.
לדוגמה, `bakery.json` יכול להכיל:
- מאפים (לחם, בורקס)
- משקאות (קפה לקניה במאפייה)
- מוצרי חלב (חמאה, חלב)

### 3. **Barcode הוא המזהה הייחודי**
כאשר מעדכנים מחירים, הסקריפט מזהה מוצרים לפי barcode.

### 4. **גיבויים אוטומטיים**
כל שינוי יוצר קובץ גיבוי עם סיומת `.backup`.
אפשר למחוק אותם לאחר וידוא שהשינויים תקינים.

---

## 📊 סטטיסטיקה

| קובץ | גודל | מוצרים (בערך) |
|------|------|---------------|
| supermarket.json | ~430KB | ~2,000 מוצרים |
| greengrocer.json | ~50KB | ~200 מוצרים |
| market.json | ~95KB | ~400 מוצרים |
| pharmacy.json | ~28KB | ~100 מוצרים |
| butcher.json | ~18KB | ~70 מוצרים |
| bakery.json | ~5KB | ~20 מוצרים |

---

## 🧹 ניקיון שבוצע

התיקיות והקבצים הבאים **נמחקו** כי לא היו בשימוש:

### ❌ תיקיות שנמחקו:
- `by_category/` - שימשו רק לסקריפטי fetch ישנים
- `by_list_type/` - כפילות מיותרת של `list_types/`
- `categories/` - גרסה ישנה ומיושנת

### ❌ קבצים שנמחקו:
- `products.json` - קובץ גדול אחד (17K שורות) שלא נמצא בשימוש

### ❌ סקריפטים שנמחקו:
- `fetch_shufersal_products.dart` - ישן
- `fetch_multiple_pages.dart` - ישן
- `split_products_by_category.dart` - ישן
- `sync_bakery_categories.dart` - ישן
- `debug_shufersal_files.dart` - debug
- `check_all_dates.dart` - debug
- `deep_search_files.dart` - debug

---

## 🎯 סיכום

- ✅ **מבנה נקי** עם תיקייה אחת למוצרים: `list_types/`
- ✅ **סקריפט יחיד** לעדכון מחירים: `update_products.dart`
- ✅ **תיעוד מלא** במסמך זה
- ✅ **קל לתחזוקה** וקל להבנה

---

**תאריך עדכון אחרון:** 18.11.2024
